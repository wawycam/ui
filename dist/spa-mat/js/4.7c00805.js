(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"/Rwy":function(t,a,e){"use strict";var i=e("3ygf"),s=e.n(i);s.a},"3ygf":function(t,a,e){},FomH:function(t,a,e){},QB95:function(t,a,e){},ax9p:function(t,a,e){"use strict";var i=e("FomH"),s=e.n(i);s.a},iyQ6:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("q-page",{staticClass:"padding"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-4"},[i("img",{attrs:{alt:"WawyCam",src:e("rWp3")}})]),i("div",{staticClass:"col-8"},[i("div",{staticClass:"row column"},[i("Info")],1),i("div",{staticClass:"padding-top"},[i("LatestTrack")],1)])])])},s=[];i._withStripped=!0;var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[t.camera?e("div",{staticClass:"col info"},[e("h2",[t._v("\n      "+t._s(t.camera.name)+"\n      "),t.ip?e("q-btn",{attrs:{color:"secondary",size:"sm",label:"online"}}):t._e(),t.ip?t._e():e("q-btn",{attrs:{color:"tertiary",size:"sm",label:"offline"}}),e("q-btn",{staticStyle:{"margin-left":"20px"},attrs:{icon:"settings",disable:!t.enableSettings,color:"warning",size:"sm",label:"settings"},on:{click:function(a){t.openSettings=!0}}})],1),e("div",{staticClass:"row"},[e("div",{staticClass:"col-6"},[e("p",[e("small",[e("strong",[t._v("Serial:")]),t._v(" "+t._s(t.camera.serial))])])]),e("div",{staticClass:"col-6"},[e("p",[e("small",[e("strong",[t._v("IP adress:")]),t._v(" "+t._s(t.ip))])])])]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-6"},[e("p",[e("small",[e("strong",[t._v("Uptime:")]),t._v(" "+t._s(t._f("uptime")(t.camera.uptime)))])])]),e("div",{staticClass:"col-6"},[e("p",[e("small",[e("strong",[t._v("Disk free:")]),t._v(" "+t._s(t.camera.diskFree)+" Go")])])])])]):t._e(),t.camera?t._e():e("div",{staticClass:"col"},[t.timeout?e("q-alert",{attrs:{type:"negative",icon:"warning",actions:[{label:"try again",handler:function(){t.getWawy()}}]}},[t._v("\n      Sorry couldn't reach your camera\n    ")]):t._e(),t.connecting?e("h3",[e("q-spinner",{attrs:{size:30}}),t._v(" connecting to your camera...")],1):t._e()],1),t.enableSettings?e("q-modal",{model:{value:t.openSettings,callback:function(a){t.openSettings=a},expression:"openSettings"}},[e("Settings",{attrs:{ssid:t.ssid,ip:t.ip,camera:t.camera}})],1):t._e(),e("q-modal",{attrs:{"no-esc-dismiss":!0,"no-backdrop-dismiss":!0},model:{value:t.openLogin,callback:function(a){t.openLogin=a},expression:"openLogin"}},[e("Login",{attrs:{title:"Authentication",help:"Please login to register your camera",callback:t.authOk}})],1)],1)},r=[];n._withStripped=!0;e("f3/d");var o=e("wd/R"),c=e.n(o),l=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("div",{staticClass:"row settings-padding"},[e("div",{staticClass:"col-12"},[e("h4",[e("q-icon",{attrs:{name:"settings"}}),t._v(" Settings\n      ")],1)]),e("div",{staticClass:"col-12"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-10"},[e("q-input",{attrs:{"float-label":"Camera Name"},model:{value:t.cameraForm.name,callback:function(a){t.$set(t.cameraForm,"name",a)},expression:"cameraForm.name"}})],1),e("div",{staticClass:"col-2"},[e("q-btn",{staticStyle:{height:"50%","margin-top":"20px"},attrs:{color:"primary"},on:{click:t.setName}},[t._v("\n            save\n          ")])],1)]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-6"},[e("q-select",{attrs:{"float-label":"Select a wifi network",options:t.ssidList},on:{focus:t.startSsidSearch,blur:t.clearSsidSearch,input:t.setWifi},model:{value:t.ssid,callback:function(a){t.ssid=a},expression:"ssid"}})],1),e("div",{staticClass:"col-6"},[t.searchingSsids?e("p",{staticClass:"search"},[e("q-spinner",{attrs:{size:15}}),t._v(" searching wifi network...\n          ")],1):t._e()])]),t.ssidPskError?e("q-alert",{attrs:{type:"negative",icon:"warning",actions:[{label:"try again",handler:function(){t.setWifi()}}]}},[t._v("\n        Unable to connect to selected Wifi, please check your password\n      ")]):t._e()],1)])])},d=[];l._withStripped=!0;e("91GP");var m=e("iV8l"),u={name:"Settings",props:["camera","ip","ssid"],data:function(){return{cameraForm:Object.assign({},this.camera),searchingSsids:!1,ssidPskError:!1,ssidsEnabled:[],ssidList:[]}},created:function(){var t=this;this.axios.get("/wifi/enabled").then(function(a){t.ssidsEnabled=a.data.list.map(function(t){return t.ssid})}),this.getSsids()},beforeDestroy:function(){this.clearSsidSearch()},methods:{setName:function(){var t=this;this.$q.dialog({title:"Confirm",message:"Change the camera name need camera reboot",ok:"Agree",cancel:"Disagree"}).then(function(){t.axios.post("/wawy/name",{name:t.cameraForm.name,lastName:t.camera.name}).then(function(a){201===a.status&&(t.$q.loading.show({spinner:m["a"],message:"Waiting while rebooting...",spinnerSize:250,spinnerColor:"white"}),t.axios.post("/service/reboot").then(function(a){if(201===a.status){var e="http://".concat(t.name,".local");setInterval(function(){t.axios.get("".concat(e,":3001/service/serial")).then(function(a){200===a.status&&(t.$q.loading.hide(),window.location.href=e)})},1e4)}}))})}).catch(function(){t.cameraForm.name=t.camera.name})},getSsids:function(){var t=this;this.axios.get("/wifi").then(function(a){var e=a.data;t.ssidList=e.list.map(function(a){var e="signal_wifi_4_bar_lock",i="grey";return t.ip&&t.ssid===a.ssid?(e="signal_wifi_4_bar",i="green"):t.ssidsEnabled.indexOf(a.ssid)>-1&&(e="signal_wifi_4_bar",i="grey"),{label:a.ssid,value:a.ssid,icon:e,leftColor:i}})})},startSsidSearch:function(){var t=this;this.getSsids(),this.searchingSsids=!0,this.pollingSsidList=setInterval(function(){t.getSsids()},3e3)},clearSsidSearch:function(){this.searchingSsids=!1,clearInterval(this.pollingSsidList)},setWifi:function(){var t=this;this.clearSsidSearch(),this.ssidPskError=!1,this.$q.dialog({title:"Password",message:"Please add password for ssid ".concat(this.ssid,"."),prompt:{model:""},cancel:!0,color:"secondary"}).then(function(a){t.$q.loading.show({message:"connecting...",spinnerSize:25,spinnerColor:"white"}),t.axios.post("/wifi",{ssid:t.ssid,psk:a}).then(function(){t.getConnectedSsid()}).catch(function(){t.$q.loading.hide(),t.ssidPskError=!0})})}}},g=u,h=(e("rgJS"),e("KHd+")),f=Object(h["a"])(g,l,d,!1,null,null,null),p=f.exports,v=e("ixY9"),_=e("1e1S"),w={name:"Info",components:{Login:v["default"],Settings:p},data:function(){return{connecting:!0,timeout:!1,camera:null,ip:null,ssid:null,enableSettings:!1,openLogin:!1,openSettings:!1}},filters:{uptime:function(t){var a=c()().diff(c()(1e3*t)),e=c.a.utc(c.a.duration(a).asMilliseconds()).toObject();return"".concat(e.date-1," days, ").concat(e.hours," hours, ").concat(e.minutes," mn")}},created:function(){this.getWawy()},methods:{getWawy:function(){var t=this;this.connecting=!0,this.timeout=!1,this.axios.get("/wawy").then(function(a){var e=a.data;t.lastName=e.name,t.$localStorage.set("tracks",JSON.stringify(e.tracks)),t.axios.get("/service/info").then(function(a){var i=a.data;t.camera={name:e.name,serial:e.serial,diskFree:i.disk.free,uptime:i.uptime},t.getConnectedSsid()})}).catch(function(){t.connecting=!1,t.timeout=!0})},getConnectedSsid:function(){var t=this;this.axios.get("/wifi/status").then(function(a){a&&a.data.ssid&&a.data.ip_address?(t.ssid=a.data.ssid,t.ip=a.data.ip_address,t.enableSettings=!0,t.$auth.check()?t.updateOrRegisterCamera():t.openLogin=!0):t.enableSettings=!0})},updateOrRegisterCamera:function(){this.$apollo.mutate({mutation:_["b"],variables:{serial:this.camera.serial,camera:{serial:this.camera.serial,name:this.camera.name,ip:this.ip}}})},authOk:function(){window.location.reload()}}},S=w,b=(e("/Rwy"),Object(h["a"])(S,n,r,!1,null,null,null)),k=b.exports,C=function(){var t=this,a=t.$createElement,e=t._self._c||a;return t.mediaTracks?e("div",[e("div",{staticClass:"col"},[e("h4",{staticClass:"padding-top margin-bottom"},[e("q-icon",{attrs:{name:"gps_fixed"}}),t._v(" Tracks")],1)]),e("div",{staticClass:"col"},[e("q-list",t._l(t.mediaTracks,function(a,i){return e("q-item",{key:i,attrs:{multiline:""}},[e("q-item-side",{attrs:{avatar:t._f("path")(a.thumb)}}),e("q-item-main",[e("q-item-tile",{attrs:{label:""}},[t._v(t._s(a.name))]),e("q-item-tile",{attrs:{sublabel:"",lines:"3"}},[t._v("\n            "+t._s(a.geoposition)+" geopositions | "+t._s(a.media)+" media\n            "),e("br"),e("br"),e("router-link",{attrs:{to:"/track/"+a.id}},[t._v("details")]),t._v(" |\n            "),e("a",{attrs:{href:""}},[t._v("download")])],1)],1),e("q-item-side",{attrs:{right:""}},[e("q-item-tile",{attrs:{stamp:""}},[t._v(t._s(t._f("fromNow")(a.date)))])],1)],1)}))],1)]):t._e()},y=[];C._withStripped=!0;e("pIFo"),e("KKXr");var q=e("LvDl"),x=e.n(q),L={name:"latest",data:function(){return{latestTrack:null,tracks:JSON.parse(this.$localStorage.get("tracks")),mediaTracks:null}},filters:{path:function(t){var a=t.split(".");a="".concat(a[0],"_480.").concat(a[1]);var e="./";return"".concat(e,"/photos/").concat(a)},fromNow:function(t){return t?c()(t).fromNow():""}},created:function(){this.getTracks()},methods:{getTracks:function(){var t=[];this.tracks&&this.tracks.length>0&&(x.a.each(this.tracks,function(a){var e=x.a.filter(a.geoData,function(t){return t.media&&t.media.file});e.length>0&&t.push({id:a._id,name:a.name,date:a.updatedAt,geoposition:a.geoData.length,media:e.length,thumb:e[0].media.file})}),this.mediaTracks=t)},getLatestTrack:function(t){var a={};if(t&&t.length>0){a=t[t.length-1];var e=x.a.filter(a.geoData,function(t){return t.media&&t.media.file});this.latestTrack={id:a._id,name:a.name,date:a.updatedAt,geoposition:a.geoData.length,media:e.length,thumb:e[0].media.file}}}}},$=L,O=Object(h["a"])($,C,y,!1,null,null,null),F=O.exports,T={name:"PageIndex",components:{Info:k,LatestTrack:F},methods:{}},E=T,P=(e("ax9p"),Object(h["a"])(E,i,s,!1,null,null,null));a["default"]=P.exports},rWp3:function(t,a,e){t.exports=e.p+"img/PiBoxFront.3dc5040.png"},rgJS:function(t,a,e){"use strict";var i=e("QB95"),s=e.n(i);s.a}}]);