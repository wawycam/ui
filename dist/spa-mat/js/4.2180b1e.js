(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"/Rwy":function(t,e,i){"use strict";var a=i("3ygf"),s=i.n(a);s.a},"3ygf":function(t,e,i){},A4F3:function(t,e,i){"use strict";var a=i("d+Bq"),s=i.n(a);s.a},FomH:function(t,e,i){},QB95:function(t,e,i){},ax9p:function(t,e,i){"use strict";var a=i("FomH"),s=i.n(a);s.a},"d+Bq":function(t,e,i){},iyQ6:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-page",{staticClass:"padding"},[i("div",{staticClass:"row justify-center"},[i("div",{staticClass:"camera col-md-4 col-sm-12"},[i("img",{attrs:{alt:"WawyCam",src:t.imageDevice}})]),i("div",{staticClass:"info col-md-8 col-sm-12"},[i("div",{staticClass:"row column"},[i("Info")],1),i("div",[i("LatestTrack")],1)])]),i("q-window-resize-observable",{on:{resize:t.onResize}})],1)},s=[];a._withStripped=!0;var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.camera?i("div",{staticClass:"col info"},[i("h2",[t._v("\n      "+t._s(t.camera.name)+"\n    ")]),i("div",{staticClass:"row",staticStyle:{"margin-bottom":"10px"}},[i("div",[t.ip?i("q-btn",{attrs:{color:"secondary",size:"sm",label:"online"}}):t._e(),t.ip?t._e():i("q-btn",{attrs:{color:"tertiary",size:"sm",label:"offline"}})],1),i("div",[i("q-btn",{staticStyle:{"margin-left":"10px"},attrs:{icon:"settings",disable:!t.enableSettings,color:"warning",size:"sm",label:"settings"},on:{click:function(e){t.openSettings=!0}}})],1)]),i("div",{staticClass:"row bg"},[i("div",{staticClass:"col-6"},[i("p",[i("small",[i("strong",[t._v("Serial:")]),t._v(" "+t._s(t.camera.serial))])])]),i("div",{staticClass:"col-6"},[i("p",[i("small",[i("strong",[t._v("IP adress:")]),t._v(" "+t._s(t.ip))])])])]),i("div",{staticClass:"row bg"},[i("div",{staticClass:"col-6"},[i("p",[i("small",[i("strong",[t._v("Uptime:")]),t._v(" "+t._s(t._f("uptime")(t.camera.uptime)))])])]),i("div",{staticClass:"col-6"},[i("p",[i("small",[i("strong",[t._v("Disk free:")]),t._v(" "+t._s(t.camera.diskFree)+" Go")])])])])]):t._e(),t.camera?t._e():i("div",{staticClass:"col"},[t.timeout?i("q-alert",{attrs:{type:"negative",icon:"warning",actions:[{label:"try again",handler:function(){t.getWawy()}}]}},[t._v("\n      Sorry couldn't reach your camera\n    ")]):t._e(),t.connecting?i("h3",[i("q-spinner",{attrs:{size:30}}),t._v(" connecting to your camera...")],1):t._e()],1),t.enableSettings?i("q-modal",{model:{value:t.openSettings,callback:function(e){t.openSettings=e},expression:"openSettings"}},[i("Settings",{attrs:{ssid:t.ssid,ip:t.ip,camera:t.camera}})],1):t._e(),i("q-modal",{attrs:{"no-esc-dismiss":!0,"no-backdrop-dismiss":!0},model:{value:t.openLogin,callback:function(e){t.openLogin=e},expression:"openLogin"}},[i("Login",{attrs:{title:"Authentication",help:"Please login to register your camera",callback:t.authOk}})],1)],1)},r=[];n._withStripped=!0;i("f3/d");var o=i("wd/R"),c=i.n(o),l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"row settings-padding"},[i("div",{staticClass:"col-12"},[i("h4",[i("q-icon",{attrs:{name:"settings"}}),t._v(" Settings\n      ")],1)]),i("div",{staticClass:"col-12"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-10"},[i("q-input",{attrs:{"float-label":"Camera Name"},model:{value:t.cameraForm.name,callback:function(e){t.$set(t.cameraForm,"name",e)},expression:"cameraForm.name"}})],1),i("div",{staticClass:"col-2"},[i("q-btn",{staticStyle:{height:"50%","margin-top":"20px"},attrs:{color:"primary"},on:{click:t.setName}},[t._v("\n            save\n          ")])],1)]),i("div",{staticClass:"row"},[i("div",{staticClass:"col-6"},[i("q-select",{attrs:{"float-label":"Select a wifi network",options:t.ssidList},on:{focus:t.startSsidSearch,blur:t.clearSsidSearch,input:t.setWifi},model:{value:t.ssid,callback:function(e){t.ssid=e},expression:"ssid"}})],1),i("div",{staticClass:"col-6"},[t.searchingSsids?i("p",{staticClass:"search"},[i("q-spinner",{attrs:{size:15}}),t._v(" searching wifi network...\n          ")],1):t._e()])]),t.ssidPskError?i("q-alert",{attrs:{type:"negative",icon:"warning",actions:[{label:"try again",handler:function(){t.setWifi()}}]}},[t._v("\n        Unable to connect to selected Wifi, please check your password\n      ")]):t._e()],1)])])},d=[];l._withStripped=!0;i("91GP");var m=i("iV8l"),u={name:"Settings",props:["camera","ip","ssid"],data:function(){return{cameraForm:Object.assign({},this.camera),searchingSsids:!1,ssidPskError:!1,ssidsEnabled:[],ssidList:[]}},created:function(){var t=this;this.axios.get("/wifi/enabled").then(function(e){t.ssidsEnabled=e.data.list.map(function(t){return t.ssid})}),this.getSsids()},beforeDestroy:function(){this.clearSsidSearch()},methods:{setName:function(){var t=this;this.$q.dialog({title:"Confirm",message:"Change the camera name need camera reboot",ok:"Agree",cancel:"Disagree"}).then(function(){t.axios.post("/wawy/name",{name:t.cameraForm.name,lastName:t.camera.name}).then(function(e){201===e.status&&(t.$q.loading.show({spinner:m["a"],message:"Waiting while rebooting...",spinnerSize:250,spinnerColor:"white"}),t.axios.post("/service/reboot").then(function(e){if(201===e.status){var i="http://".concat(t.name,".local");setInterval(function(){t.axios.get("".concat(i,":3001/service/serial")).then(function(e){200===e.status&&(t.$q.loading.hide(),window.location.href=i)})},1e4)}}))})}).catch(function(){t.cameraForm.name=t.camera.name})},getSsids:function(){var t=this;this.axios.get("/wifi").then(function(e){var i=e.data;t.ssidList=i.list.map(function(e){var i="signal_wifi_4_bar_lock",a="grey";return t.ip&&t.ssid===e.ssid?(i="signal_wifi_4_bar",a="green"):t.ssidsEnabled.indexOf(e.ssid)>-1&&(i="signal_wifi_4_bar",a="grey"),{label:e.ssid,value:e.ssid,icon:i,leftColor:a}})})},startSsidSearch:function(){var t=this;this.getSsids(),this.searchingSsids=!0,this.pollingSsidList=setInterval(function(){t.getSsids()},3e3)},clearSsidSearch:function(){this.searchingSsids=!1,clearInterval(this.pollingSsidList)},setWifi:function(){var t=this;this.clearSsidSearch(),this.ssidPskError=!1,this.$q.dialog({title:"Password",message:"Please add password for ssid ".concat(this.ssid,"."),prompt:{model:""},cancel:!0,color:"secondary"}).then(function(e){t.$q.loading.show({message:"connecting...",spinnerSize:25,spinnerColor:"white"}),t.axios.post("/wifi",{ssid:t.ssid,psk:e}).then(function(){t.getConnectedSsid()}).catch(function(){t.$q.loading.hide(),t.ssidPskError=!0})})}}},g=u,f=(i("rgJS"),i("KHd+")),h=Object(f["a"])(g,l,d,!1,null,null,null),p=h.exports,v=i("ixY9"),_=i("1e1S"),w={name:"Info",components:{Login:v["default"],Settings:p},data:function(){return{connecting:!0,timeout:!1,camera:null,ip:null,ssid:null,enableSettings:!1,openLogin:!1,openSettings:!1}},filters:{uptime:function(t){var e=c()().diff(c()(1e3*t)),i=c.a.utc(c.a.duration(e).asMilliseconds()).toObject();return"".concat(i.date-1," days, ").concat(i.hours," hours, ").concat(i.minutes," mn")}},created:function(){this.getWawy()},methods:{getWawy:function(){var t=this;this.connecting=!0,this.timeout=!1,this.axios.get("/wawy").then(function(e){var i=e.data;t.lastName=i.name,t.$localStorage.set("tracks",JSON.stringify(i.tracks)),t.axios.get("/service/info").then(function(e){var a=e.data;t.camera={name:i.name,serial:i.serial,diskFree:a.disk.free,uptime:a.uptime},t.getConnectedSsid()})}).catch(function(){t.connecting=!1,t.timeout=!0})},getConnectedSsid:function(){var t=this;this.axios.get("/wifi/status").then(function(e){e&&e.data.ssid&&e.data.ip_address?(t.ssid=e.data.ssid,t.ip=e.data.ip_address,t.enableSettings=!0,t.$auth.check()?t.updateOrRegisterCamera():t.openLogin=!0):t.enableSettings=!0})},updateOrRegisterCamera:function(){this.$apollo.mutate({mutation:_["b"],variables:{serial:this.camera.serial,camera:{serial:this.camera.serial,name:this.camera.name,ip:this.ip}}})},authOk:function(){window.location.reload()}}},b=w,S=(i("/Rwy"),Object(f["a"])(b,n,r,!1,null,null,null)),k=S.exports,C=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.mediaTracks?i("div",[i("div",[i("q-list",{attrs:{"no-border":"","inset-separator":""}},t._l(t.mediaTracks,function(e,a){return i("q-item",{key:a,attrs:{multiline:""}},[i("q-item-side",{attrs:{avatar:t._f("path")(e.thumb)}}),i("q-item-main",[i("q-item-tile",{attrs:{label:""}},[t._v(t._s(e.name))]),i("q-item-tile",{attrs:{sublabel:"",lines:"3"}},[t._v("\n            "+t._s(e.geoposition)+" geopositions | "+t._s(e.media)+" media\n            "),i("br"),i("br"),i("router-link",{attrs:{to:"/track/"+e.id}},[t._v("details")]),t._v(" |\n            "),i("a",{attrs:{href:""}},[t._v("download")])],1)],1),i("q-item-side",{attrs:{right:""}},[i("q-item-tile",{attrs:{stamp:""}},[t._v(t._s(t._f("fromNow")(e.date)))])],1)],1)}))],1)]):t._e()},y=[];C._withStripped=!0;i("pIFo"),i("KKXr");var q=i("LvDl"),x=i.n(q),F={name:"latest",data:function(){return{latestTrack:null,tracks:JSON.parse(this.$localStorage.get("tracks")),mediaTracks:null}},filters:{path:function(t){var e=t.split(".");e="".concat(e[0],"_480.").concat(e[1]);var i="./";return"".concat(i,"/photos/").concat(e)},fromNow:function(t){return t?c()(t).fromNow():""}},created:function(){this.getTracks()},methods:{getTracks:function(){var t=[];this.tracks&&this.tracks.length>0&&(x.a.each(this.tracks,function(e){var i=x.a.filter(e.geoData,function(t){return t.media&&t.media.file});i.length>0&&t.push({id:e._id,name:e.name,date:e.updatedAt,geoposition:e.geoData.length,media:i.length,thumb:i[0].media.file})}),this.mediaTracks=t)},getLatestTrack:function(t){var e={};if(t&&t.length>0){e=t[t.length-1];var i=x.a.filter(e.geoData,function(t){return t.media&&t.media.file});this.latestTrack={id:e._id,name:e.name,date:e.updatedAt,geoposition:e.geoData.length,media:i.length,thumb:i[0].media.file}}}}},L=F,$=(i("A4F3"),Object(f["a"])(L,C,y,!1,null,null,null)),O=$.exports,P={name:"PageIndex",components:{Info:k,LatestTrack:O},data:function(){return{imageDevice:"statics/PiBoxFront.png"}},methods:{onResize:function(t){t.width<768?this.imageDevice="statics/PiBoxFront90.png":this.imageDevice="statics/PiBoxFront.png"}}},D=P,z=(i("ax9p"),Object(f["a"])(D,a,s,!1,null,null,null));e["default"]=z.exports},rgJS:function(t,e,i){"use strict";var a=i("QB95"),s=i.n(a);s.a}}]);