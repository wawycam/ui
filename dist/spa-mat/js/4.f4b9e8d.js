(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{FomH:function(t,i,a){},ax9p:function(t,i,a){"use strict";var s=a("FomH"),e=a.n(s);e.a},iyQ6:function(t,i,a){"use strict";a.r(i);var s=function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("q-page",{staticClass:"padding-top",attrs:{padding:""}},[s("div",{staticClass:"row no-wrap justify-center items-center"},[s("div",{staticClass:"col-4 q-pr-lg",staticStyle:{"text-align":"right"}},[s("img",{staticStyle:{width:"80%"},attrs:{alt:"WawyCam",src:a("rWp3")}})]),t.name?t._e():s("div",{staticClass:"col"},[t.timeout?s("q-alert",{attrs:{type:"negative",icon:"warning",actions:[{label:"try again",handler:function(){t.getWawy()}}]}},[t._v("\n        Sorry couldn't reach your camera\n      ")]):t._e(),t.connecting?s("h3",[s("q-spinner",{attrs:{size:30}}),t._v(" connecting to your camera...")],1):t._e()],1),t.name?s("div",{staticClass:"col"},[s("div",{staticClass:"row column"},[s("div",{staticClass:"col info"},[s("h2",[t._v("\n            "+t._s(t.name)+"\n            "),t.ip?s("q-btn",{attrs:{color:"secondary",size:"sm",label:"online"}}):t._e(),t.ip?t._e():s("q-btn",{attrs:{color:"tertiary",size:"sm",label:"offline"}})],1),s("p",[s("small",[s("strong",[t._v("Serial:")]),t._v(" "+t._s(t.serial))])]),s("p",[s("small",[s("strong",[t._v("IP adress:")]),t._v(" "+t._s(t.ip))])]),s("p",[s("small",[s("strong",[t._v("Uptime:")]),t._v(" "+t._s(t._f("uptime")(t.uptime)))])]),s("p",[s("small",[s("strong",[t._v("Disk free:")]),t._v(" "+t._s(t.diskFree)+" Go")])])]),s("div",{staticClass:"col"},[s("h4",{staticClass:"padding-top margin-bottom"},[s("q-icon",{attrs:{name:"settings"}}),t._v(" Settings")],1)]),s("div",{staticClass:"col margin-bottom"},[s("div",{staticClass:"row"},[s("q-input",{attrs:{"float-label":"Camera Name"},model:{value:t.name,callback:function(i){t.name=i},expression:"name"}}),s("q-btn",{staticStyle:{height:"50%","margin-top":"20px"},attrs:{color:"primary"},on:{click:t.setName}},[t._v("\n              save\n            ")])],1)]),s("div",{staticClass:"col margin-bottom"},[s("div",{staticClass:"row"},[s("q-select",{attrs:{"float-label":"Select a wifi network",options:t.ssidList},on:{focus:t.startSsidSearch,blur:t.clearSsidSearch,input:t.setWifi},model:{value:t.ssid,callback:function(i){t.ssid=i},expression:"ssid"}}),t.searchingSsids?s("p",{staticStyle:{"padding-top":"20px","padding-left":"20px"}},[s("q-spinner",{attrs:{size:15}}),t._v(" searching wifi network...\n            ")],1):t._e()],1),t.ssidPskError?s("q-alert",{attrs:{type:"negative",icon:"warning",actions:[{label:"try again",handler:function(){t.setWifi()}}]}},[t._v("\n            Unable to connect to selected Wifi, please check your password\n          ")]):t._e()],1),s("div",{staticClass:"col"},[s("div",{staticClass:"row"},[t.latestTrack?s("LatestTrack",{attrs:{latestTrack:t.latestTrack}}):t._e()],1)])])]):t._e()]),s("q-modal",{attrs:{"no-esc-dismiss":!0,"no-backdrop-dismiss":!0},model:{value:t.openLogin,callback:function(i){t.openLogin=i},expression:"openLogin"}},[s("Login",{attrs:{title:"Authentication",help:"Please login to register your camera",callback:t.authOk}})],1)],1)},e=[];s._withStripped=!0;a("f3/d");var n=a("wd/R"),o=a.n(n),r=a("LvDl"),l=a.n(r),c=a("iV8l"),d=a("1e1S"),m=a("ixY9"),u=function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("div",[a("div",{staticClass:"col"},[a("h4",{staticClass:"padding-top margin-bottom"},[a("q-icon",{attrs:{name:"gps_fixed"}}),t._v(" Tracks")],1)]),a("div",{staticClass:"col"},[a("q-list",[a("q-item",{attrs:{multiline:""}},[a("q-item-side",{attrs:{avatar:t._f("path")(t.latestTrack.thumb)}}),a("q-item-main",[a("q-item-tile",{attrs:{label:""}},[t._v(t._s(t.latestTrack.name))]),a("q-item-tile",{attrs:{sublabel:"",lines:"3"}},[t._v("\n            "+t._s(t.latestTrack.geoposition)+" geopositions | "+t._s(t.latestTrack.media)+" media\n            "),a("br"),a("br"),a("router-link",{attrs:{to:"/track/"+t.latestTrack.id}},[t._v("details")]),t._v(" |\n            "),a("a",{attrs:{href:""}},[t._v("download")])],1)],1),a("q-item-side",{attrs:{right:""}},[a("q-item-tile",{attrs:{stamp:""}},[t._v(t._s(t._f("fromNow")(t.latestTrack.date)))])],1)],1)],1)],1)])},p=[];u._withStripped=!0;a("pIFo"),a("KKXr");var g={name:"latest",props:["latestTrack"],filters:{path:function(t){var i=t.split(".");i="".concat(i[0],"_480.").concat(i[1]);var a="./";return"".concat(a,"/photos/").concat(i)},fromNow:function(t){return t?o()(t).fromNow():""}}},h=g,f=a("KHd+"),v=Object(f["a"])(h,u,p,!1,null,null,null),_=v.exports,w={name:"PageIndex",components:{Login:m["default"],LatestTrack:_},data:function(){return{openLogin:!1,connecting:!0,timeout:!1,searchingSsids:!1,oldName:"",name:null,serial:"",diskFree:0,uptime:0,ssid:null,ssidPskError:!1,ip:null,ssidsEnabled:[],ssidList:[],latestTrack:null}},created:function(){this.getWawy()},beforeDestroy:function(){this.clearSsidSearch()},filters:{uptime:function(t){var i=o()().diff(o()(1e3*t)),a=o.a.utc(o.a.duration(i).asMilliseconds()).toObject();return"".concat(a.date-1," days, ").concat(a.hours," hours, ").concat(a.minutes," mn")}},methods:{authOk:function(){window.location.reload()},getWawy:function(){var t=this;this.connecting=!0,this.timeout=!1,this.axios.get("/wawy").then(function(i){var a=i.data;t.lastName=a.name,t.name=a.name,t.serial=a.serial,t.getLatestTrack(a.tracks),t.$localStorage.set("tracks",JSON.stringify(a.tracks)),t.axios.get("/service/info").then(function(i){var a=i.data;t.diskFree=a.disk.free,t.uptime=a.uptime})}).catch(function(){t.connecting=!1,t.timeout=!0,clearInterval(t.pollingSsidList)}),this.axios.get("/wifi/enabled").then(function(i){t.ssidsEnabled=i.data.list.map(function(t){return t.ssid})}),this.getSsids(),this.getConnectedSsid()},getSsids:function(){var t=this;this.searchingSsids=!0,this.axios.get("/wifi").then(function(i){var a=i.data;t.ssidList=a.list.map(function(i){var a="signal_wifi_4_bar_lock",s="grey";return t.ip&&t.ssid===i.ssid?(a="signal_wifi_4_bar",s="green"):t.ssidsEnabled.indexOf(i.ssid)>-1&&(a="signal_wifi_4_bar",s="grey"),{label:i.ssid,value:i.ssid,icon:a,leftColor:s}})})},getConnectedSsid:function(){var t=this;this.axios.get("/wifi/status").then(function(i){i&&i.data.ssid&&i.data.ip_address&&(t.$q.loading.hide(),t.clearSsidSearch(),t.ssid=i.data.ssid,t.ip=i.data.ip_address,t.$auth.check()?t.updateOrRegisterCamera():t.openLogin=!0)})},startSsidSearch:function(){var t=this;this.getSsids(),this.pollingSsidList=setInterval(function(){t.getSsids()},3e3)},clearSsidSearch:function(){this.searchingSsids=!1,clearInterval(this.pollingSsidList)},setName:function(){var t=this;this.$q.dialog({title:"Confirm",message:"Change the camera name need camera reboot",ok:"Agree",cancel:"Disagree"}).then(function(){t.axios.post("/wawy/name",{name:t.name,lastName:t.lastName}).then(function(i){201===i.status&&(t.$q.loading.show({spinner:c["a"],message:"Waiting while rebooting...",spinnerSize:250,spinnerColor:"white"}),t.axios.post("/service/reboot").then(function(i){if(201===i.status){var a="http://".concat(t.name,".local");setInterval(function(){t.axios.get("".concat(a,":3001/service/serial")).then(function(i){200===i.status&&(t.$q.loading.hide(),window.location.href=a)})},1e4)}}))})}).catch(function(){t.name=t.lastName})},setWifi:function(){var t=this;this.clearSsidSearch(),this.ssidPskError=!1,this.$q.dialog({title:"Password",message:"Please add password for ssid ".concat(this.ssid,"."),prompt:{model:""},cancel:!0,color:"secondary"}).then(function(i){t.$q.loading.show({message:"connecting...",spinnerSize:25,spinnerColor:"white"}),t.axios.post("/wifi",{ssid:t.ssid,psk:i}).then(function(){t.getConnectedSsid()}).catch(function(){t.$q.loading.hide(),t.ssidPskError=!0})})},updateOrRegisterCamera:function(){this.$apollo.mutate({mutation:d["b"],variables:{serial:this.serial,camera:{serial:this.serial,name:this.name,ip:this.ip}}})},getLatestTrack:function(t){var i={};if(t&&t.length>0){i=t[t.length-1];var a=l.a.filter(i.geoData,function(t){return t.media&&t.media.file});this.latestTrack={id:i._id,name:i.name,date:i.updatedAt,geoposition:i.geoData.length,media:a.length,thumb:a[0].media.file}}}}},k=w,b=(a("ax9p"),Object(f["a"])(k,s,e,!1,null,null,null));i["default"]=b.exports},rWp3:function(t,i,a){t.exports=a.p+"img/PiBoxFront.3dc5040.png"}}]);